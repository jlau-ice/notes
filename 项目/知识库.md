

# Todos
[ ] 
ç¬¬1å‘¨ç¬¬1å¤©: æ­å»ºç¯å¢ƒå¹¶è¿è¡Œé¡¹ç›®
[ ] 
ç¬¬1å‘¨ç¬¬2-3å¤©: ç†è§£æ•´ä½“æ¶æ„å’Œç›®å½•ç»“æ„
[ ] 
ç¬¬1å‘¨ç¬¬4-5å¤©: æ–‡æ¡£ä¸Šä¼ æµç¨‹æ·±å…¥åˆ†æ
[ ] 
ç¬¬2å‘¨ç¬¬1-2å¤©: æ™®é€šé—®ç­”æµç¨‹æ·±åº¦å‰–æ
[ ] 
ç¬¬2å‘¨ç¬¬3-4å¤©: Agentæ¨¡å¼å’ŒReActå¾ªç¯
[ ] 
ç¬¬2å‘¨ç¬¬5å¤©: æ£€ç´¢ç­–ç•¥å’Œç®—æ³•å®ç°
[ ] 
ç¬¬3å‘¨ç¬¬1-2å¤©: çŸ¥è¯†åº“ç®¡ç†æ ¸å¿ƒé€»è¾‘
[ ] 
ç¬¬3å‘¨ç¬¬3-4å¤©: æ–‡æ¡£è§£æå’Œå¤šæ¨¡æ€å¤„ç†
[ ] 
ç¬¬3å‘¨ç¬¬5å¤©: å‰ç«¯æ¶æ„å’ŒçŠ¶æ€ç®¡ç†
[ ] 
ç¬¬4å‘¨ç¬¬1-2å¤©: å®æˆ˜æ”¹é€ -æ·»åŠ æ–°çš„æ£€ç´¢ç­–ç•¥
[ ] 
ç¬¬4å‘¨ç¬¬3-4å¤©: å®æˆ˜æ”¹é€ -å¼€å‘æ–°çš„Agentå·¥å…·
[ ] 
ç¬¬4å‘¨ç¬¬5å¤©: æ¢³ç†é¡¹ç›®äº®ç‚¹å’Œé¢è¯•è¯æœ¯
Thinking: å¥½çš„ï¼Œæˆ‘å·²ç»åˆ›å»ºäº†å­¦ä¹ è®¡åˆ’ã€‚ç°åœ¨è®©æˆ‘ä¸ºç”¨æˆ·æä¾›è¯¦ç»†çš„å­¦ä¹ è·¯çº¿ï¼ŒåŒ…æ‹¬æ¯ä¸ªé˜¶æ®µçš„å…·ä½“ä»»åŠ¡å’Œéœ€è¦é˜…è¯»çš„æ–‡ä»¶ã€‚
ğŸ“š 4å‘¨ç³»ç»Ÿå­¦ä¹ è®¡åˆ’
ç¬¬1å‘¨ï¼šåŸºç¡€æ¶æ„å’Œæ ¸å¿ƒæµç¨‹
Day 1: ç¯å¢ƒæ­å»ºå’Œé¡¹ç›®è¿è¡Œ
# 1. å¯åŠ¨é¡¹ç›®
./scripts/start_all.sh
# 2. è®¿é—®Web UIï¼Œå®Œæˆä»¥ä¸‹æ“ä½œ
# - æ³¨å†Œç™»å½•
# - åˆ›å»ºä¸€ä¸ªæ–‡æ¡£çŸ¥è¯†åº“
# - ä¸Šä¼ ä¸€ä¸ªPDFæ–‡æ¡£
# - å°è¯•æé—®
# - åˆ›å»ºä¸€ä¸ªFAQçŸ¥è¯†åº“
# - å¼€å¯Agentæ¨¡å¼æé—®
è¦ç†è§£çš„é—®é¢˜ï¼š
- é¡¹ç›®æœ‰å“ªäº›ä¾èµ–æœåŠ¡ï¼Ÿï¼ˆPostgreSQLã€Redisã€Elasticsearchç­‰ï¼‰
- Web UIå’Œåç«¯APIå¦‚ä½•äº¤äº’ï¼Ÿ
- Docker Composeå¦‚ä½•ç¼–æ’æœåŠ¡ï¼Ÿ
---
Day 2-3: æ•´ä½“æ¶æ„å’Œç›®å½•ç»“æ„
éœ€è¦é˜…è¯»çš„æ–‡ä»¶ï¼š
- cmd/server/main.go - å…¥å£æ–‡ä»¶
- internal/router/router.go - è·¯ç”±å®šä¹‰
- internal/container/container.go - ä¾èµ–æ³¨å…¥
- internal/handler/ - æ‰€æœ‰Handleræ¥å£
- internal/application/service/ - æœåŠ¡å±‚
- go.mod - æŠ€æœ¯æ ˆ
è¦ç†è§£çš„æ¦‚å¿µï¼š
- ä¾èµ–æ³¨å…¥å¦‚ä½•å®ç°ï¼Ÿ(digåº“)
- Handler â†’ Service â†’ Repository åˆ†å±‚æ¶æ„
- EventBusäº‹ä»¶æ€»çº¿å¦‚ä½•å·¥ä½œï¼Ÿ(internal/event/)
- å¼‚æ­¥ä»»åŠ¡å¦‚ä½•å¤„ç†ï¼Ÿ(Asynq)
ç”»å›¾ç»ƒä¹ ï¼š
ç”»ä¸€ä¸ªç³»ç»Ÿæ¶æ„å›¾ï¼ŒåŒ…å«ï¼š
- å‰ç«¯
- åç«¯API
- DocReaderæœåŠ¡
- å„ä¸ªå­˜å‚¨(PostgreSQLã€Redisã€ESã€Neo4jã€MinIO)
- MQå¼‚æ­¥ä»»åŠ¡
---
Day 4-5: æ–‡æ¡£ä¸Šä¼ æµç¨‹æ·±åº¦åˆ†æ
æ ¸å¿ƒæ–‡ä»¶ï¼š
- internal/handler/knowledge.go:103 - CreateKnowledgeFromFile
- internal/application/service/knowledge.go:44 - Serviceå±‚
- docreader/main.py - æ–‡æ¡£è§£ææœåŠ¡
- internal/searchutil/retriever.go - å‘é‡ç´¢å¼•
è¦ç†è§£çš„å…³é”®ç‚¹ï¼š
1. åŒæ­¥é˜¶æ®µåšäº†ä»€ä¹ˆï¼Ÿ
// knowledge.go:103-359
- æ–‡ä»¶éªŒè¯(ç±»å‹ã€å¤§å°)
- è®¡ç®—MD5å“ˆå¸Œå»é‡
- æ£€æŸ¥å­˜å‚¨é…é¢
- ä¿å­˜çŸ¥è¯†è®°å½•åˆ°DB
- ä¿å­˜æ–‡ä»¶åˆ°å¯¹è±¡å­˜å‚¨(COS/MinIO)
- å…¥é˜ŸAsynqå¼‚æ­¥ä»»åŠ¡
2. å¼‚æ­¥é˜¶æ®µåšäº†ä»€ä¹ˆï¼Ÿ
DocReaderè§£æ â†’ ç”ŸæˆChunks â†’ å‘é‡åŒ– â†’ å†™å…¥ç´¢å¼• â†’ æ›´æ–°çŠ¶æ€
3. Chunkæœ‰å“ªäº›ç±»å‹ï¼Ÿ
ChunkTypeText        // æ–‡æœ¬Chunk
ChunkTypeImageOCR    // å›¾ç‰‡OCRæ–‡æœ¬
ChunkTypeImageCaption// å›¾ç‰‡æè¿°
4. å¦‚ä½•ä¿è¯å¹‚ç­‰æ€§ï¼Ÿ
- æ–‡ä»¶å“ˆå¸Œå»é‡
- ParseStatusçŠ¶æ€ç®¡ç†
5. å‘é‡å¦‚ä½•å­˜å‚¨ï¼Ÿ
- PostgreSQL(pgvector) æˆ– Elasticsearch
- ä½¿ç”¨ BatchIndex() æ‰¹é‡å†™å…¥
å®æˆ˜ç»ƒä¹ ï¼š
åœ¨ knowledge.go:103 å¤„æ‰“æ–­ç‚¹ï¼Œè·Ÿè¸ªä¸€ä¸ªPDFä¸Šä¼ çš„å®Œæ•´æµç¨‹ï¼Œè§‚å¯Ÿï¼š
- æ•°æ®åº“è¡¨çš„å˜åŒ–
- Asynqä»»åŠ¡çš„åˆ›å»º
- å‘é‡ç´¢å¼•çš„å†™å…¥
---
ç¬¬2å‘¨ï¼šé—®ç­”æµç¨‹å’ŒAgentæ¨¡å¼
Day 1-2: æ™®é€šé—®ç­”æµç¨‹æ·±åº¦å‰–æ
æ ¸å¿ƒæ–‡ä»¶ï¼š
- internal/handler/session/qa.go:251 - KnowledgeQA
- internal/application/service/session.go:91 - Serviceå±‚
- internal/searchutil/knowledge_search.go - æœç´¢é€»è¾‘
- internal/searchutil/composite.go - å¤åˆæ£€ç´¢å¼•æ“
è¦ç†è§£çš„å…³é”®æµç¨‹ï¼š
1. æŸ¥è¯¢å¤„ç†æµæ°´çº¿
// knowledge_search.go
- æŸ¥è¯¢é‡å†™(å¯é€‰)
- å®ä½“æŠ½å–(å¯é€‰)
- å¹¶è¡Œæ£€ç´¢(å¤šçŸ¥è¯†åº“ã€å¤šæŸ¥è¯¢)
- Reranké‡æ’åº
- MMRå»é‡
- åˆå¹¶ç»“æœ
2. æ··åˆæ£€ç´¢
// composite.go:28-90
å‘é‡æ£€ç´¢:
  - è°ƒç”¨embeddingæ¨¡å‹è·å–queryå‘é‡
  - åœ¨å‘é‡æ•°æ®åº“ä¸­æœç´¢æœ€ç›¸ä¼¼çš„chunks
  - TopK = matchCount * 3
å…³é”®è¯æ£€ç´¢:
  - ä½¿ç”¨BM25ç®—æ³•
  - åœ¨Elasticsearchä¸­æœç´¢
  - TopK = matchCount * 3
RRFèåˆ:
  - å¯¹å¤šä¸ªæ£€ç´¢ç»“æœè¿›è¡Œèåˆ
  - å…¬å¼: rrfScore = Î£(1 / (60 + rank))
3. Rerankç­–ç•¥
// knowledge_search.go:306-576
ä¼˜å…ˆçº§:
4. LLM Rerank(å¦‚æœé…ç½®äº†chatModel)
5. Rerankæ¨¡å‹(å¦‚æœé…ç½®äº†rerankModel)
6. ä¸Rerank(FAQçŸ¥è¯†åº“)
LLM Rerank Prompt:
- å¯¹æ¯ä¸ªchunkæ‰“åˆ†(0.0-1.0)
- æ‰¹é‡å¤„ç†(æ¯æ‰¹15ä¸ª)
4. å¤šçº§å»é‡
// knowledge_search.go:889-954
5. IDå»é‡
6. ParentChunkIDå»é‡
7. Contentç­¾åå»é‡(MD5)
8. MMRå¤šæ ·æ€§å»é‡(Î»=0.7)
å®æˆ˜ç»ƒä¹ ï¼š
- ä¿®æ”¹RRFèåˆå‚æ•°ï¼Œè§‚å¯Ÿæ£€ç´¢ç»“æœå˜åŒ–
- å°è¯•è°ƒæ•´MMRçš„lambdaå€¼ï¼Œç†è§£ç›¸å…³æ€§vså¤šæ ·æ€§çš„æƒè¡¡
- åœ¨ knowledgebase.go:486 å¤„æ‰“æ–­ç‚¹ï¼Œè·Ÿè¸ªä¸€æ¬¡æœç´¢
---
Day 3-4: Agentæ¨¡å¼å’ŒReActå¾ªç¯
æ ¸å¿ƒæ–‡ä»¶ï¼š
- internal/agent/engine.go - Agentå¼•æ“
- internal/handler/session/qa.go:276 - AgentQA
- internal/agent/tools/ - å·¥å…·å®ç°
è¦ç†è§£çš„æ ¸å¿ƒæ¦‚å¿µï¼š
1. ReActå¾ªç¯
Think â†’ Act â†’ Observe â†’ Repeat â†’ FinalAnswer
2. Agentå¼•æ“åˆå§‹åŒ–
// engine.go:47-73
AgentEngine{
  config:              agentConfig,
  toolRegistry:        toolRegistry,
  chatModel:           chatModel,
  eventBus:            eventBus,       // æµå¼è¿”å›
  knowledgeBasesInfo:  kbInfos,
  selectedDocs:        selectedDocs,   // ç”¨æˆ·@çš„æ–‡æ¡£
  contextManager:      contextManager,
}
3. å·¥å…·æ³¨å†Œæœºåˆ¶
// custom_agent.go:96-326
å†…ç½®å·¥å…·:
- knowledge_search: çŸ¥è¯†åº“æœç´¢
- web_search: ç½‘ç»œæœç´¢
- grep_chunks: æ–‡æœ¬å…¨æ–‡æœç´¢
- query_knowledge_graph: çŸ¥è¯†å›¾è°±æŸ¥è¯¢
- data_analysis: æ•°æ®åˆ†æ
æ‰©å±•å·¥å…·:
- MCPå·¥å…·(é€šè¿‡MCPåè®®æ‰©å±•)
4. äº‹ä»¶æµ
// engine.go:287-297
EventAgentThought       â†’ LLMæ€è€ƒè¿‡ç¨‹
EventAgentToolCall      â†’ å·¥å…·è°ƒç”¨å¼€å§‹
EventAgentToolResult    â†’ å·¥å…·æ‰§è¡Œç»“æœ
EventAgentReflection    â†’ åæ€è¿‡ç¨‹(å¯é€‰)
EventAgentFinalAnswer   â†’ æœ€ç»ˆç­”æ¡ˆ
EventAgentComplete      â†’ å¯¹è¯å®Œæˆ
5. Agentæ€è€ƒè¿‡ç¨‹
// engine.go:172-450
for round < maxIterations {
  // 1. Think: LLMæ¨ç†
  response := chatModel.ChatStream(messages, tools)
  
  // 2. æ£€æŸ¥æ˜¯å¦å®Œæˆ
  if finishReason == "stop" && noToolCalls {
    break  // ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ
  }
  
  // 3. Act: æ‰§è¡Œå·¥å…·
  for toolCall := response.ToolCalls {
    result := toolRegistry.ExecuteTool(toolCall)
  }
  
  // 4. Observe: å°†å·¥å…·ç»“æœåŠ å…¥å†å²
  messages = appendToolResults(messages, result)
  
  // 5. åæ€(å¯é€‰)
  if reflectionEnabled {
    reflection := chatModel.ChatStream(messages, reflectionPrompt)
  }
}
å®æˆ˜ç»ƒä¹ ï¼š
åœ¨ engine.go:172 å¤„æ‰“æ–­ç‚¹ï¼Œè·Ÿè¸ªä¸€æ¬¡Agentå¯¹è¯ï¼Œè§‚å¯Ÿï¼š
- ReActå¾ªç¯çš„æ‰§è¡Œè¿‡ç¨‹
- å·¥å…·è°ƒç”¨çš„å‚æ•°å’Œç»“æœ
- EventBuså¦‚ä½•æµå¼è¿”å›äº‹ä»¶
---
Day 5: æ£€ç´¢ç­–ç•¥å’Œç®—æ³•å®ç°
æ ¸å¿ƒæ–‡ä»¶ï¼š
- internal/searchutil/composite.go - å¤åˆæ£€ç´¢
- internal/searchutil/textutil.go - æ–‡æœ¬å·¥å…·
- internal/handler/knowledgebase.go:641-718 - RRFèåˆ
è¦ç†è§£çš„ç®—æ³•ï¼š
1. RRFèåˆ
// knowledgebase.go:641-718
const rrfK = 60
// è®¡ç®—æ¯ä¸ªchunkçš„RRFåˆ†æ•°
rrfScore = 0
if vectorRanks[chunkID] exists:
  rrfScore += 1 / (60 + vectorRanks[chunkID])
if keywordRanks[chunkID] exists:
  rrfScore += 1 / (60 + keywordRanks[chunkID])
// åˆ†æ•°èŒƒå›´: [0, ~0.033]
// ä¸¤ä¸ªæ’åéƒ½æ˜¯1æ—¶: 2/(60+1) = 0.033
2. å†…å®¹ç­¾å
// textutil.go:11-21
func BuildContentSignature(content string) string {
  c := strings.ToLower(strings.TrimSpace(content))
  c = strings.Join(strings.Fields(c), " ")  // æ ‡å‡†åŒ–ç©ºæ ¼
  hash := md5.Sum([]byte(c))
  return hex.EncodeToString(hash[:])
}
3. MMRç®—æ³•
// knowledge_search.go:1316-1391
lambda = 0.7  // å¹³è¡¡ç›¸å…³æ€§å’Œå¤šæ ·æ€§
for selected < k:
  mmrScore = lambda * relevance - (1-lambda) * maxRedundancy
  é€‰æ‹©mmrScoreæœ€é«˜çš„chunk
  
  redundancy = JaccardSimilarity(chunk, selectedChunks)
Jaccard = intersectionSize / unionSize
4. å»é‡ç­–ç•¥
// knowledge_search.go:889-954
å¤šç»´åº¦å»é‡key:
5. ID
6. parent:ParentChunkID
7. kb:KnowledgeBaseID#ChunkIndex
8. ContentSignature(MD5)
---
ç¬¬3å‘¨ï¼šçŸ¥è¯†ç®¡ç†å’Œæ–‡æ¡£è§£æ
Day 1-2: çŸ¥è¯†åº“ç®¡ç†æ ¸å¿ƒé€»è¾‘
æ ¸å¿ƒæ–‡ä»¶ï¼š
- internal/handler/knowledgebase.go - çŸ¥è¯†åº“Handler
- internal/handler/knowledge.go - çŸ¥è¯†Handler
- internal/application/service/knowledgebase.go - æœåŠ¡å±‚
è¦ç†è§£çš„å…³é”®ç‚¹ï¼š
1. çŸ¥è¯†åº“ç±»å‹
Document: æ–‡æ¡£çŸ¥è¯†åº“(ä¸Šä¼ PDFã€Wordç­‰)
FAQ: FAQçŸ¥è¯†åº“(é—®ç­”å¯¹)
2. çŸ¥è¯†åº“é…ç½®
EmbeddingModelID  // å‘é‡æ¨¡å‹
RetrieverType     // æ£€ç´¢ç±»å‹
ExtractConfig     // çŸ¥è¯†å›¾è°±æŠ½å–é…ç½®
3. åˆ é™¤çŸ¥è¯†åº“æµç¨‹
// knowledgebase.go:219-269
4. è½¯åˆ é™¤çŸ¥è¯†åº“è®°å½•
5. å…¥é˜Ÿå¼‚æ­¥æ¸…ç†ä»»åŠ¡
6. å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ:
   - åˆ é™¤å‘é‡ç´¢å¼•
   - åˆ é™¤chunks
   - åˆ é™¤ç‰©ç†æ–‡ä»¶
   - è°ƒæ•´ç§Ÿæˆ·å­˜å‚¨é…é¢
   - åˆ é™¤çŸ¥è¯†å›¾è°±æ•°æ®
   - åˆ é™¤çŸ¥è¯†è®°å½•
4. å­˜å‚¨é…é¢ç®¡ç†
// knowledgebase.go:116-170
- æ£€æŸ¥ç§Ÿæˆ·å­˜å‚¨é…é¢
- ä¸Šä¼ æ—¶éªŒè¯
- åˆ é™¤æ—¶è°ƒæ•´
---
Day 3-4: æ–‡æ¡£è§£æå’Œå¤šæ¨¡æ€å¤„ç†
æ ¸å¿ƒæ–‡ä»¶ï¼š
- docreader/main.py - DocReaderä¸»ç¨‹åº
- docreader/parser/ - è§£æå™¨
- docreader/ocr/ - OCRæ¨¡å—
- internal/handler/knowledge.go:1032-1389 - Chunkå¤„ç†
è¦ç†è§£çš„æŠ€æœ¯ï¼š
1. æ–‡æ¡£è§£ææµç¨‹
# main.py
1. æ ¹æ®æ–‡ä»¶ç±»å‹é€‰æ‹©è§£æå™¨
2. PDFParser / WordParser / MarkdownParser
3. æå–æ–‡æœ¬ã€å›¾ç‰‡ã€è¡¨æ ¼
4. æ–‡æœ¬åˆ‡åˆ†(splitter)
5. å›¾ç‰‡å¤„ç†(OCR + Caption)
6. è¿”å›proto.Chunkåˆ—è¡¨
7. å¤šæ¨¡æ€æ”¯æŒ
// knowledge.go:1032-1389
ChunkTypeText: åŸå§‹æ–‡æœ¬
ChunkTypeImageOCR: å›¾ç‰‡OCRè¯†åˆ«çš„æ–‡æœ¬
ChunkTypeImageCaption: å›¾ç‰‡çš„æè¿°(Captionæ¨¡å‹ç”Ÿæˆ)
8. Chunkå…³ç³»
Chunk.ParentChunkID: çˆ¶chunk ID
Chunk.NextChunkID: ä¸‹ä¸€ä¸ªchunk ID
Chunk.PrevChunkID: ä¸Šä¸€ä¸ªchunk ID
---
Day 5: å‰ç«¯æ¶æ„å’ŒçŠ¶æ€ç®¡ç†
æ ¸å¿ƒæ–‡ä»¶ï¼š
- frontend/src/ - å‰ç«¯æºç 
- frontend/package.json - æŠ€æœ¯æ ˆ
è¦ç†è§£çš„æŠ€æœ¯ï¼š
- Vue 3 + TypeScript
- çŠ¶æ€ç®¡ç†(å¯èƒ½æ˜¯Piniaæˆ–Vuex)
- ç»„ä»¶ç»“æ„
- APIè°ƒç”¨
---
ç¬¬4å‘¨ï¼šå®æˆ˜æ”¹é€ å’Œé¢è¯•å‡†å¤‡
Day 1-2: å®æˆ˜æ”¹é€ -æ·»åŠ æ–°çš„æ£€ç´¢ç­–ç•¥
ä»»åŠ¡ï¼š
åœ¨ç°æœ‰æ£€ç´¢ç­–ç•¥åŸºç¡€ä¸Šï¼Œæ·»åŠ ä¸€ä¸ª"æ—¶é—´è¡°å‡"ç­–ç•¥
æ­¥éª¤ï¼š
1. åœ¨ internal/searchutil/ åˆ›å»ºæ–°çš„æ£€ç´¢å™¨
2. åœ¨ composite.go æ³¨å†Œæ–°æ£€ç´¢å™¨
3. å®ç°æ—¶é—´è¡°å‡ç®—æ³•ï¼š
      score = relevance * exp(-lambda * (now - createdAt))
   4. åœ¨Handlerä¸­æ·»åŠ é…ç½®é¡¹
è¦ç†è§£ï¼š
- æ£€ç´¢å™¨æ¥å£å®šä¹‰
- å¦‚ä½•æ³¨å†Œå’Œè°ƒç”¨æ£€ç´¢å™¨
- å¦‚ä½•è·å–çŸ¥è¯†åº“çš„åˆ›å»ºæ—¶é—´
---
Day 3-4: å®æˆ˜æ”¹é€ -å¼€å‘æ–°çš„Agentå·¥å…·
ä»»åŠ¡ï¼š
å¼€å‘ä¸€ä¸ªæ–°çš„Agentå·¥å…·"summarize_docs"ï¼Œç”¨äºæ€»ç»“å¤šä¸ªæ–‡æ¡£
æ­¥éª¤ï¼š
1. åœ¨ internal/agent/tools/ åˆ›å»ºæ–°å·¥å…·
2. å®šä¹‰å·¥å…·å‚æ•°ï¼š
      type SummarizeDocsInput struct {
       KnowledgeIDs []string `json:"knowledge_ids"`
   }
   3. å®ç°å·¥å…·é€»è¾‘ï¼š
      - è·å–æŒ‡å®šæ–‡æ¡£çš„æ‰€æœ‰chunks
   - è°ƒç”¨LLMç”Ÿæˆæ€»ç»“
   - è¿”å›æ€»ç»“ç»“æœ
   4. åœ¨ custom_agent.go æ³¨å†Œå·¥å…·
è¦ç†è§£ï¼š
- å·¥å…·æ¥å£å®šä¹‰
- å¦‚ä½•è®¿é—®çŸ¥è¯†åº“æ•°æ®
- å¦‚ä½•è°ƒç”¨LLM
- å¦‚ä½•æ³¨å†Œå·¥å…·
---
Day 5: æ¢³ç†é¡¹ç›®äº®ç‚¹å’Œé¢è¯•è¯æœ¯
ğŸ¯ é¡¹ç›®äº®ç‚¹æ€»ç»“
æŠ€æœ¯äº®ç‚¹
1. RAGæ¶æ„è®¾è®¡
- æ··åˆæ£€ç´¢(å‘é‡+å…³é”®è¯)
- RRFèåˆç®—æ³•
- å¤šçº§å»é‡(ID/Parent/Content/MMR)
- LLM Rerankæå‡ç²¾åº¦
2. Agentæ¨¡å¼
- ReActå¾ªç¯å®ç°
- ä¸°å¯Œçš„å·¥å…·ç”Ÿæ€
- EventBusäº‹ä»¶é©±åŠ¨
- åæ€èƒ½åŠ›
3. å¼‚æ­¥ä»»åŠ¡å¤„ç†
- Asynqå¼‚æ­¥é˜Ÿåˆ—
- æ–‡æ¡£è§£æå¼‚æ­¥åŒ–
- çŸ¥è¯†åº“åˆ é™¤å¼‚æ­¥æ¸…ç†
- çŠ¶æ€è¿½è¸ª
4. å¤šæ¨¡æ€æ”¯æŒ
- å›¾ç‰‡OCRè¯†åˆ«
- å›¾ç‰‡Captionç”Ÿæˆ
- å¤šç±»å‹Chunkç®¡ç†
- å›¾æ–‡æ··åˆæ£€ç´¢
5. å¯æ‰©å±•æ¶æ„
- æ£€ç´¢å™¨æ’ä»¶åŒ–
- å·¥å…·æ³¨å†Œæœºåˆ¶
- MCPåè®®æ‰©å±•
- å¤šå‘é‡æ•°æ®åº“æ”¯æŒ
é¢è¯•è¯æœ¯
Q1: ä»‹ç»ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®ï¼Ÿ
è¿™æ˜¯ä¸€ä¸ªåŸºäºå¤§è¯­è¨€æ¨¡å‹çš„æ–‡æ¡£ç†è§£ä¸æ£€ç´¢æ¡†æ¶ï¼Œæ ¸å¿ƒé‡‡ç”¨RAGæ¶æ„ã€‚
æˆ‘è´Ÿè´£äº†æ–‡æ¡£ä¸Šä¼ ã€çŸ¥è¯†åº“ç®¡ç†ã€é—®ç­”æ£€ç´¢ç­‰æ ¸å¿ƒæ¨¡å—çš„å¼€å‘ã€‚
æŠ€æœ¯æ ˆï¼šGo 1.24 + Gin + GORM + PostgreSQL + Elasticsearch + Redis + Asynq
Q2: å¦‚ä½•å¤„ç†æ–‡æ¡£ä¸Šä¼ ï¼Ÿ
æ–‡æ¡£ä¸Šä¼ åˆ†ä¸ºåŒæ­¥å’Œå¼‚æ­¥ä¸¤ä¸ªé˜¶æ®µï¼š
åŒæ­¥é˜¶æ®µï¼š
1. æ–‡ä»¶éªŒè¯(ç±»å‹ã€å¤§å°ã€å“ˆå¸Œå»é‡)
2. æ£€æŸ¥å­˜å‚¨é…é¢
3. ä¿å­˜çŸ¥è¯†è®°å½•åˆ°æ•°æ®åº“
4. ä¿å­˜æ–‡ä»¶åˆ°å¯¹è±¡å­˜å‚¨
5. å…¥é˜ŸAsynqå¼‚æ­¥ä»»åŠ¡
å¼‚æ­¥é˜¶æ®µï¼š
6. è°ƒç”¨DocReaderæœåŠ¡è§£ææ–‡æ¡£
7. ç”Ÿæˆæ–‡æœ¬Chunkså’Œå›¾ç‰‡Chunks(OCR/Caption)
8. è°ƒç”¨embeddingæ¨¡å‹ç”Ÿæˆå‘é‡
9. æ‰¹é‡å†™å…¥å‘é‡ç´¢å¼•
10. æ›´æ–°çŸ¥è¯†çŠ¶æ€
è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯ï¼š
- å“åº”å¿«ï¼šç”¨æˆ·æ— éœ€ç­‰å¾…æ–‡æ¡£è§£æå®Œæˆ
- è§£è€¦ï¼šDocReaderç‹¬ç«‹æœåŠ¡ï¼Œå¯æ°´å¹³æ‰©å±•
- å¯é ï¼šå¼‚æ­¥ä»»åŠ¡æ”¯æŒé‡è¯•
Q3: å¦‚ä½•å®ç°ç²¾å‡†æ£€ç´¢ï¼Ÿ
æˆ‘ä»¬é‡‡ç”¨äº†æ··åˆæ£€ç´¢+å¤šçº§ä¼˜åŒ–ç­–ç•¥ï¼š
1. æ··åˆæ£€ç´¢ï¼š
   - å‘é‡æ£€ç´¢ï¼šä½¿ç”¨embeddingæ¨¡å‹ï¼Œåœ¨å‘é‡æ•°æ®åº“ä¸­æœç´¢
   - å…³é”®è¯æ£€ç´¢ï¼šä½¿ç”¨BM25ç®—æ³•ï¼Œåœ¨Elasticsearchä¸­æœç´¢
2. RRFèåˆï¼š
   - å¯¹å‘é‡ç»“æœå’Œå…³é”®è¯ç»“æœè¿›è¡Œèåˆ
   - å…¬å¼ï¼šrrfScore = Î£(1 / (60 + rank))
3. å¤šçº§å»é‡ï¼š
   - IDå»é‡ï¼šé¿å…é‡å¤chunk
   - ParentChunkIDå»é‡ï¼šé¿å…çˆ¶å­chunké‡å¤
   - Contentç­¾åå»é‡ï¼šMD5å»é‡ç›¸ä¼¼å†…å®¹
   - MMRå»é‡ï¼šå¹³è¡¡ç›¸å…³æ€§å’Œå¤šæ ·æ€§
4. LLM Rerankï¼š
   - ä¼˜å…ˆä½¿ç”¨LLMå¯¹æ£€ç´¢ç»“æœé‡æ’åº
   - å¦‚æœæ²¡æœ‰é…ç½®LLMï¼Œå›é€€åˆ°ä¸“ç”¨Rerankæ¨¡å‹
Q4: Agentæ¨¡å¼æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ
Agentæ¨¡å¼é‡‡ç”¨ReActå¾ªç¯æœºåˆ¶ï¼š
1. å·¥å…·æ³¨å†Œï¼š
   - å†…ç½®å·¥å…·ï¼šknowledge_search, web_search, grep_chunksç­‰
   - MCPå·¥å…·ï¼šé€šè¿‡MCPåè®®æ‰©å±•
   - æ‰€æœ‰å·¥å…·ç»Ÿä¸€æ³¨å†Œåˆ°ToolRegistry
2. ReActå¾ªç¯ï¼š
   Think â†’ Act â†’ Observe â†’ Repeat â†’ FinalAnswer
   Think: LLMæ¨ç†ï¼Œå†³å®šæ˜¯å¦è°ƒç”¨å·¥å…·
   Act: æ‰§è¡Œå·¥å…·è°ƒç”¨
   Observe: å°†å·¥å…·ç»“æœåŠ å…¥å¯¹è¯å†å²
   Repeat: é‡å¤å¾ªç¯ï¼Œç›´åˆ°LLMå†³å®šå®Œæˆ
3. äº‹ä»¶æµï¼š
   - ä½¿ç”¨EventBusæµå¼è¿”å›
   - åŒ…æ‹¬ï¼šæ€è€ƒè¿‡ç¨‹ã€å·¥å…·è°ƒç”¨ã€å·¥å…·ç»“æœã€æœ€ç»ˆç­”æ¡ˆ
4. åæ€èƒ½åŠ›ï¼š
   - å¯é€‰çš„å¯¹å·¥å…·ç»“æœçš„åæ€
   - ä½¿ç”¨LLMè¯„ä¼°å·¥å…·ç»“æœè´¨é‡
Q5: å¦‚ä½•ä¿è¯ç³»ç»Ÿçš„å¯é æ€§ï¼Ÿ
1. å¹‚ç­‰æ€§ï¼š
   - æ–‡ä»¶å“ˆå¸Œå»é‡
   - ParseStatusçŠ¶æ€ç®¡ç†
2. å¼‚æ­¥ä»»åŠ¡ï¼š
   - ä½¿ç”¨Asynqè¿›è¡Œå¼‚æ­¥å¤„ç†
   - æ”¯æŒä»»åŠ¡é‡è¯•
   - ä»»åŠ¡çŠ¶æ€è¿½è¸ª
3. é”™è¯¯å¤„ç†ï¼š
   - å…¨é¢çš„é”™è¯¯ç å®šä¹‰
   - ä¼˜é›…çš„é”™è¯¯å¤„ç†
   - æ—¥å¿—è®°å½•
4. äº‹åŠ¡å¤„ç†ï¼š
   - å…³é”®æ“ä½œä½¿ç”¨æ•°æ®åº“äº‹åŠ¡
   - ä¿è¯æ•°æ®ä¸€è‡´æ€§
5. é…é¢ç®¡ç†ï¼š
   - ç§Ÿæˆ·å­˜å‚¨é…é¢é™åˆ¶
   - é¿å…èµ„æºæ»¥ç”¨
Q6: é‡åˆ°çš„æŒ‘æˆ˜å’Œè§£å†³æ–¹æ¡ˆï¼Ÿ
æŒ‘æˆ˜1ï¼šæ–‡æ¡£è§£ææ€§èƒ½
è§£å†³æ–¹æ¡ˆï¼š
- ä½¿ç”¨å¼‚æ­¥ä»»åŠ¡è§£è€¦
- DocReaderç‹¬ç«‹æœåŠ¡
- æ”¯æŒå¹¶å‘å¤„ç†
æŒ‘æˆ˜2ï¼šæ£€ç´¢ç²¾åº¦
è§£å†³æ–¹æ¡ˆï¼š
- æ··åˆæ£€ç´¢
- RRFèåˆ
- LLM Rerank
- å¤šçº§å»é‡
æŒ‘æˆ˜3ï¼šå¤§æ–‡æ¡£å¤„ç†
è§£å†³æ–¹æ¡ˆï¼š
- æ–‡æœ¬åˆ‡åˆ†(splitter)
- åˆ†æ‰¹å‘é‡åŒ–å’Œç´¢å¼•
- å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—
æŒ‘æˆ˜4ï¼šå¤šæ¨¡æ€æ”¯æŒ
è§£å†³æ–¹æ¡ˆï¼š
- å›¾ç‰‡OCRè¯†åˆ«
- å›¾ç‰‡Captionç”Ÿæˆ
- å¤šç±»å‹Chunkç®¡ç†
---
ğŸ“ å­¦ä¹ æ¸…å•
ç¬¬1å‘¨å¿…é¡»ç†è§£çš„æ–‡ä»¶
- [ ] cmd/server/main.go
- [ ] internal/router/router.go
- [ ] internal/container/container.go
- [ ] internal/handler/knowledge.go:103
- [ ] internal/application/service/knowledge.go:44
- [ ] docreader/main.py
- [ ] internal/searchutil/retriever.go
ç¬¬2å‘¨å¿…é¡»ç†è§£çš„æ–‡ä»¶
- [ ] internal/handler/session/qa.go:251
- [ ] internal/handler/session/qa.go:276
- [ ] internal/application/service/session.go:91
- [ ] internal/searchutil/knowledge_search.go
- [ ] internal/searchutil/composite.go:28-90
- [ ] internal/agent/engine.go:47-73
- [ ] internal/agent/engine.go:172-450
- [ ] internal/agent/tools/
- [ ] internal/handler/knowledgebase.go:641-718
ç¬¬3å‘¨å¿…é¡»ç†è§£çš„æ–‡ä»¶
- [ ] internal/handler/knowledgebase.go:70-438
- [ ] internal/handler/knowledge.go:1032-1389
- [ ] docreader/parser/
- [ ] docreader/ocr/
ç¬¬4å‘¨å®æˆ˜ä»»åŠ¡
- [ ] æ·»åŠ æ—¶é—´è¡°å‡æ£€ç´¢ç­–ç•¥
- [ ] å¼€å‘summarize_docså·¥å…·
- [ ] æ¢³ç†é¡¹ç›®äº®ç‚¹å’Œé¢è¯•è¯æœ¯
---
æŒ‰ç…§è¿™ä¸ªè®¡åˆ’æ‰§è¡Œï¼Œä½ å°±èƒ½å½»åº•åƒé€è¿™ä¸ªé¡¹ç›®ï¼Œåœ¨é¢è¯•ä¸­ä¾ƒä¾ƒè€Œè°ˆï¼